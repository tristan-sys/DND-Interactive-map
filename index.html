<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>D&D Shield Countdown</title>
  <style>
    body {
      margin: 0;
      background: #111;
      color: #eee;
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #map-container {
      position: relative;
      display: inline-block;
    }
    #map {
      width: 1920px;
      border: 4px solid #1b342f;
    }
    .shield-counter {
      position: absolute;
      padding: 6px 10px;
      border-radius: 10px;
      font-size: 0.9em;
      font-weight: bold;
      cursor: pointer;
      transform: translate(-50%, -50%);
      transition: background-color 0.3s;
      border: 2px solid #fff;
      text-align: center;
      white-space: nowrap;
    }
    .green { background-color: rgba(0, 128, 0, 0.7); }
    .yellow { background-color: rgba(255, 165, 0, 0.7); }
    .red { background-color: rgba(139, 0, 0, 0.8); }

    #toggle {
      margin: 15px auto;
      padding: 10px 20px;
      font-size: 1rem;
      background: #333;
      color: #fff;
      border: 2px solid #0fc;
      border-radius: 8px;
      cursor: pointer;
    }
    #toggle:hover {
      background: #0fc;
      color: #000;
    }

    .config-panel {
      margin-top: 20px;
      color: #fff;
      background: #222;
      border: 2px solid #0fc;
      border-radius: 10px;
      padding: 15px;
      display: inline-block;
    }

    .config-row {
      margin: 8px 0;
    }

    select, input[type="number"] {
      padding: 5px;
      font-size: 0.95em;
      border-radius: 5px;
      border: 1px solid #aaa;
    }

    button.apply {
      margin-left: 10px;
      padding: 5px 10px;
      background: #0fc;
      border: none;
      border-radius: 5px;
      color: #000;
      cursor: pointer;
    }

    button.apply:hover {
      background: #0c9;
    }
  </style>
</head>
<body>
  <body>
  <h1>D&D World Shield Countdown</h1>
  <button id="toggle">‚è∏ Pause Countdown</button>
  <button id="adminLogin">üîê Admin Login</button>

  <div class="config-panel" id="configPanel" style="display: none;">
    <div class="config-row">
      <label for="townSelect">üõ° Select Town: </label>
      <select id="townSelect"></select>
    </div>
    <div class="config-row">
      <label for="durationInput">üîß New Duration (Years): </label>
      <input type="number" id="durationInput" min="1" max="50" />
      <button class="apply" id="applyBtn">Apply</button>
    </div>
  </div>

  <div id="map-container">
    <img id="map" src="map.png" alt="D&D Map" />
  </div>

  <script>
    const ADMIN_PASSWORD = "dmsecret";

    document.getElementById("adminLogin").onclick = () => {
      const input = prompt("Enter DM password:");
      if (input === ADMIN_PASSWORD) {
        document.getElementById("configPanel").style.display = "inline-block";
        alert("‚úÖ Admin mode enabled.");
      } else {
        alert("‚ùå Incorrect password.");
      }
    };
  </script>
</body>
    </div>
  </div>

  <div id="map-container">
    <img id="map" src="" alt="D&D Map" />
  </div>

  <script>
    const minutesPerYear = 20;
    const millisecondsPerYear = minutesPerYear * 60 * 1000;

    let paused = false;

    const towns = [
      { name: "Bright Hollow", years: 10, x: 1310, y: 560, wiki: "https://example.com/dragonmere" },
      { name: "Solmere", years: 7, x: 900, y: 300, wiki: "https://example.com/dragonmere" },
      { name: "Dawnmere", years: 5, x: 1265, y: 699, wiki: "https://example.com/moonwatch" },
      { name: "Frostmaw", years: 7, x: 1495, y: 331, wiki: "https://example.com/dragonmere" },
      { name: "Elaria's Rest", years: 7, x: 1034, y: 403, wiki: "https://example.com/dragonmere" },
      { name: "Noctspire", years: 7, x: 1585, y: 701, wiki: "https://example.com/dragonmere" },
      { name: "Bazionia", years: 7, x: 1415, y: 181, wiki: "https://example.com/dragonmere" }
    ];

    const mapContainer = document.getElementById("map-container");
    const townSelect = document.getElementById("townSelect");
    const durationInput = document.getElementById("durationInput");

    const countdownData = [];

    // Populate dropdown
    towns.forEach((town, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.textContent = town.name;
      townSelect.appendChild(opt);
    });

    // Create shield counters
    towns.forEach((town, index) => {
      const div = document.createElement("div");
      div.className = "shield-counter";
      div.style.left = `${town.x}px`;
      div.style.top = `${town.y}px`;
      div.id = `shield-${index}`;
      mapContainer.appendChild(div);

      const getEndTime = (years) => Date.now() + years * millisecondsPerYear;

      countdownData[index] = {
        town,
        element: div,
        endTime: getEndTime(town.years)
      };

      // Handle click to open wiki
      div.onclick = () => window.open(town.wiki, "_blank");
    });

    // Update UI every second
    setInterval(() => {
      countdownData.forEach(({ town, element, endTime }, i) => {
        if (paused) return;

        const now = Date.now();
        const remaining = Math.max(0, countdownData[i].endTime - now);
        const yearsLeft = remaining / millisecondsPerYear;

        let className = "shield-counter ";
        if (yearsLeft > 5) className += "green";
        else if (yearsLeft > 1) className += "yellow";
        else className += "red";

        element.className = className;

        if (yearsLeft <= 0) {
          element.textContent = `${town.name}: Shield Fallen!`;
        } else {
          const timeLeft = new Date(remaining).toISOString().substr(11, 8);
          element.textContent = `${town.name}: ${timeLeft}`;
        }
      });
    }, 1000);

    // Toggle Pause/Resume
    document.getElementById("toggle").onclick = function () {
      paused = !paused;
      this.textContent = paused ? "‚ñ∂Ô∏è Resume Countdown" : "‚è∏ Pause Countdown";
    };

    // Apply new duration
    document.getElementById("applyBtn").onclick = () => {
      const index = parseInt(townSelect.value);
      const newYears = parseInt(durationInput.value);
      if (isNaN(newYears) || newYears <= 0) return alert("Enter a valid number of years.");
      countdownData[index].endTime = Date.now() + newYears * millisecondsPerYear;
    };
  </script>
</body>
</html>
